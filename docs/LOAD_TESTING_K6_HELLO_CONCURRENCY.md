# ุชุณุช ุจุงุฑ ููุฒูุงู (Concurrency Load Test) ุจุง k6 ุจุฑุง Endpoint `/hello`

ุงู ูุณุชูุฏ ุฑุงูููุง ฺฉุงูู ุงุฌุฑุง ู ุชุญูู ุชุณุช ุจุงุฑ ููุฒูุงู (ุจุฏูู sleep) ุจุฑุง endpoint `/hello` ุงุณุช. ุงู ูุณุชูุฏ ุจุฑุง ฺฏุฒุงุฑุดโุฏู ุจู ุชู ู ูุฑุฌุน ุจููุฏูุฏุช ุทุฑุงุญ ุดุฏู ุงุณุช.

---

## 0. ุขุดูุง ุจุง k6

### k6 ฺุณุชุ

**k6** ฺฉ ุงุจุฒุงุฑ load testing ูุฏุฑู ู open-source ุงุณุช ฺฉู ุชูุณุท [Grafana Labs](https://k6.io/) ุชูุณุนู ุฏุงุฏู ุดุฏู ุงุณุช. k6 ุจุฑุง ุชุณุช ุนููฺฉุฑุฏ ู ุธุฑูุช APIูุง ู ุณุฑูุณโูุง ูุจ ุทุฑุงุญ ุดุฏู ุงุณุช.

### ูฺฺฏโูุง ฺฉูุฏ k6

- **ููุดุชู ุชุณุชโูุง ุจุง JavaScript (ES6 modules)**: ุชุณุชโูุง ุฑุง ุจุง JavaScript ูโููุณุฏ
- **Virtual Users (VU)**: ูุฑ VU ฺฉ ฺฉุงุฑุจุฑ ูุฌุงุฒ ุงุณุช ฺฉู ุชุงุจุน `default()` ุฑุง ุจู ุตูุฑุช ููุงุฒ ุงุฌุฑุง ูโฺฉูุฏ
- **ูุชุฑฺฉโูุง ุฌุงูุน**: ุฎุฑูุฌโูุง ููู ุดุงูู `http_req_duration` (latency)ุ `http_req_failed`ุ RPSุ p95/p99ุ ู error rate
- **Thresholds**: ุงูฺฉุงู ุชุนุฑู ูุนุงุฑูุง ููููุช/ุดฺฉุณุช ุชุณุช
- **ุณูุงุฑููุง ูุฎุชูู**: ูพุดุชุจุงู ุงุฒ ุงููุงุน ูุฎุชูู ุชุณุช (stages, constant-arrival-rate, ramping-arrival-rate ู ...)

### ููุงูู ูพุงู

#### Virtual User (VU)

ูุฑ VU ฺฉ ฺฉุงุฑุจุฑ ูุฌุงุฒ ุงุณุช ฺฉู:
- ุชุงุจุน `default()` ุฑุง ุจู ุตูุฑุช loop ุงุฌุฑุง ูโฺฉูุฏ
- ุจู ุตูุฑุช ููุงุฒ ุจุง ุณุงุฑ VUูุง ฺฉุงุฑ ูโฺฉูุฏ
- ูโุชูุงูุฏ ุฏุฑุฎูุงุณุช HTTP ุงุฑุณุงู ฺฉูุฏุ sleep ฺฉูุฏุ ู ุนููุงุช ุฏฺฏุฑ ุงูุฌุงู ุฏูุฏ

#### Iteration

ูุฑ ุจุงุฑ ุงุฌุฑุง ุชุงุจุน `default()` ฺฉ iteration ูุญุณูุจ ูโุดูุฏ. ุชุนุฏุงุฏ iterationูุง ุจู ุชุนุฏุงุฏ VU ู ูุฏุช ุฒูุงู ุชุณุช ุจุณุชฺฏ ุฏุงุฑุฏ.

#### RPS (Requests Per Second)

ูุฑุฎ ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู. ุงู ูุนุงุฑ ูุดุงู ูโุฏูุฏ ุณุณุชู ฺูุฏ ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู ูโุชูุงูุฏ ูพุฑุฏุงุฒุด ฺฉูุฏ.

**ูฺฉุชู ููู:** RPS ุฏุฑ k6 ูุนูููุงู ูุชุฌู ุงู ุฑุงุจุทู ุงุณุช:
```
RPS โ VUs รท iteration_duration
```

ุงฺฏุฑ `sleep(1)` ุฏุงุดุชู ุจุงุดุฏุ ูุฑ VU ุชูุฑุจุงู 1 ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู ูโุฒูุฏ. ุงฺฏุฑ sleep ูุฏุงุดุชู ุจุงุดุฏุ ูุฑ VU ุชุง ุญุฏ ุงูฺฉุงู ุณุฑุน ุฏุฑุฎูุงุณุช ูโุฒูุฏ.

### ูุชุฑฺฉโูุง ููู k6

| ูุชุฑฺฉ | ุชูุถุญ |
|-------|-------|
| `http_req_duration` | ูุฏุช ุฒูุงู ูุฑ ุฏุฑุฎูุงุณุช HTTP (ุงุฒ ุฏุฏ ฺฉูุงูุช) |
| `http_req_failed` | ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง ูุงูููู (timeout, connection error ู ...) |
| `http_reqs` | ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง |
| `iterations` | ุชุนุฏุงุฏ ฺฉู iterationูุง |
| `vus` | ุชุนุฏุงุฏ Virtual Userูุง ูุนุงู |
| `p(95)`, `p(99)` | ุตุฏฺฉ 95 ู 99 (95% ู 99% ุฏุฑุฎูุงุณุชโูุง ุฒุฑ ุงู ููุฏุงุฑ) |

### Thresholds ุฏุฑ k6

**Threshold** ุนู "ุฎุท ูุฑูุฒ / ุดุฑุท ูุจูู ุชุณุช". ุดูุง ุจู k6 ูโฺฏูุฏ:
- ุงฺฏุฑ ูุชุฑฺฉ X ุงุฒ ููุฏุงุฑ/ุดุฑุท Y ุจุฏุชุฑ ุดุฏุ ุชุณุช Fail ุญุณุงุจ ุดูุฏ

**ูุซุงู:**
```javascript
thresholds: {
  http_req_failed: ['rate<0.01'],      // ฺฉูุชุฑ ุงุฒ 1% ุฎุทุง
  http_req_duration: ['p(95)<200'],    // 95% ุฏุฑุฎูุงุณุชโูุง ุฒุฑ 200ms
}
```

**ูฺฉุชู:** Threshold ุชุณุช ุฑุง ูุชููู ููโฺฉูุฏุ ููุท ุฏุฑ ูพุงุงู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุดุฑูุท ุฑุนุงุช ุดุฏู ุง ูู. ุงฺฏุฑ ุฑุนุงุช ูุดุฏู ุจุงุดุฏุ k6 exit code ุบุฑ ุตูุฑ ูโุฏูุฏ (ุจุฑุง CI/CD ููู ุงุณุช).

### ุงููุงุน Executor ุฏุฑ k6

k6 ุงุฒ executorูุง ูุฎุชูู ูพุดุชุจุงู ูโฺฉูุฏ:

1. **`shared-iterations`**: ุชุนุฏุงุฏ ฺฉู iterationูุง ูุดุฎุต ุงุณุช
2. **`per-vu-iterations`**: ูุฑ VU ุชุนุฏุงุฏ ูุดุฎุต iteration ุงุฌุฑุง ูโฺฉูุฏ
3. **`constant-vus`**: ุชุนุฏุงุฏ ุซุงุจุช VU ุจุฑุง ูุฏุช ูุดุฎุต
4. **`ramping-vus`**: ุชุนุฏุงุฏ VU ุจู ุตูุฑุช ูุฑุญููโุง ุชุบุฑ ูโฺฉูุฏ (stages)
5. **`constant-arrival-rate`**: ูุฑุฎ ุซุงุจุช ุฏุฑุฎูุงุณุช (RPS-based)
6. **`ramping-arrival-rate`**: ูุฑุฎ ุฏุฑุฎูุงุณุช ุจู ุตูุฑุช ูุฑุญููโุง ุชุบุฑ ูโฺฉูุฏ

---

## 1. ููุฏูู

### ูุฏู ุชุณุช ุจุงุฑ ููุฒูุงู

ุชุณุช ุจุงุฑ ููุฒูุงู (Concurrency Load Test) ุจู ูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง:
- **ุธุฑูุช ุญุฏุงฺฉุซุฑ ุณุณุชู** ุฑุง ุดูุงุณุง ฺฉูู
- **ููุทู ุดฺฉุณุช** (breaking point) ุฑุง ูพุฏุง ฺฉูู
- **ุฑูุชุงุฑ ุณุณุชู ุชุญุช ูุดุงุฑ** ุฑุง ุจุฑุฑุณ ฺฉูู
- **ูุญุฏูุฏุชโูุง ููุฒูุงู** ุฑุง ุดูุงุณุง ฺฉูู

### ฺุฑุง Endpoint `/hello`ุ

Endpoint `/hello` ฺฉ endpoint ุณุงุฏู ู ุณุฑุน ุงุณุช ฺฉู:
- ุจุฏูู ูุงุจุณุชฺฏ ุจู ุฏุชุงุจุณ ฺฉุงุฑ ูโฺฉูุฏ
- ูพุฑุฏุงุฒุด ุณูฺฏู ูุฏุงุฑุฏ
- ุจุฑุง ุชุณุช ุธุฑูุช ุฎุงูุต ุณุณุชู ููุงุณุจ ุงุณุช
- ูุชุงุฌ ูุงุจู ุชฺฉุฑุงุฑ ู ูุงุจู ููุงุณู ุงุณุช

### ุชูุงูุช ุชุณุช ููุฒูุงู ุจุง ุชุณุช ูุจุชู ุจุฑ RPS

| ูฺฺฏ | ุชุณุช ููุฒูุงู (Concurrency) | ุชุณุช ูุจุชู ุจุฑ RPS |
|-------|---------------------------|------------------|
| **ฺฉูุชุฑู** | ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู ููุฒูุงู (VU) | ูุฑุฎ ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู (RPS) |
| **ุฑูุชุงุฑ** | ูุฑ VU ุชุง ุญุฏ ุงูฺฉุงู ุณุฑุน ุฏุฑุฎูุงุณุช ูโุฒูุฏ | ูุฑุฎ ุซุงุจุช ุฏุฑุฎูุงุณุช |
| **ูุฏู** | ูพุฏุง ฺฉุฑุฏู ุธุฑูุช ุญุฏุงฺฉุซุฑ | ูพุฏุง ฺฉุฑุฏู ุธุฑูุช ูพุงุฏุงุฑ |
| **ููุงุณุจ ุจุฑุง** | ุชุณุช ูุดุงุฑ ู ุงุดุจุงุน | ุชุณุช ุจุงุฑ ูุงูุน |

---

## 2. ุชุณุชโูุง ููุฏูุงุช

ูุจู ุงุฒ ุงุฌุฑุง ุชุณุช ุจุงุฑ ููุฒูุงู (ุชุณุช ุดูุงุฑู 3)ุ ุจูุชุฑ ุงุณุช ุจุง ุชุณุชโูุง ุณุงุฏูโุชุฑ ุดุฑูุน ฺฉูุฏ ุชุง:
- ูุทูุฆู ุดูุฏ k6 ู ุณุฑูุณ ุฏุฑุณุช ฺฉุงุฑ ูโฺฉููุฏ
- ฺฉ baseline ุจุฑุง ููุงุณู ุฏุงุดุชู ุจุงุดุฏ
- ุจุง ููุงูู ูพุงู k6 ุขุดูุง ุดูุฏ

### ุชุณุช 1: Smoke Test (ุชุณุช ุฏูุฏ)

**ูุฏู:** ุงุทููุงู ุงุฒ ุงูฺฉู ุณุฑูุณ ุฏุฑ ุฏุณุชุฑุณ ุงุณุช ู ุจู ุฏุฑุณุช ูพุงุณุฎ ูโุฏูุฏ.

**ูุงู:** `k6/01-hello-smoke.js`

```javascript
import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = { vus: 1, duration: '10s' };

export default function () {
  const res = http.get('http://localhost:8080/hello');
  check(res, { 'status is 200': (r) => r.status === 200 });
  sleep(1);
}
```

**ุชูุถุญ:**
- **1 VU**: ฺฉ ฺฉุงุฑุจุฑ ูุฌุงุฒ
- **10s duration**: ุชุณุช ุจู ูุฏุช 10 ุซุงูู ุงุฌุฑุง ูโุดูุฏ
- **sleep(1)**: ุจู ูุฑ iterationุ 1 ุซุงูู ุตุจุฑ ูโฺฉูุฏ
- **ูุชุฌู:** ุชูุฑุจุงู 10 ุฏุฑุฎูุงุณุช (1 ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู)

**ุงุฌุฑุง:**
```bash
k6 run k6/01-hello-smoke.js
```

**ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ:**
- `http_req_failed: 0.00%` (ุจุฏูู ุฎุทุง)
- `http_req_duration: avg < 10ms` (latency ูพุงู)
- `checks: 100%` (ููู ฺฺฉโูุง ูููู)

**ูฺฉุชู:** ุงฺฏุฑ ุงู ุชุณุช ูููู ุจุงุดุฏุ ูโุชูุงูุฏ ุจู ุชุณุชโูุง ูพุดุฑูุชูโุชุฑ ุจุฑูุฏ.

**ุชุญูู RPS:**
ุจุง `sleep(1)`ุ ูุฑ VU ุชูุฑุจุงู 1 ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู ูโุฒูุฏ. ูพุณ:
- **1 VU ร 1 req/s = ~1 RPS**

ุงู ุชุณุช ุจุฑุง ุจุฑุฑุณ ุฏุณุชุฑุณ ุณุฑูุณ ุงุณุชุ ูู ุธุฑูุช.

### ุชุณุช 2: Baseline Test ุจุง Stages (ุชุณุช ูพุงู)

**ูุฏู:** ฺฏุฑูุชู baseline ุจุฑุง ููุงุณู ุจุง ุชุณุชโูุง ุจุนุฏ.

**ูุงู:** `k6/02-hello-stages.js`

```javascript
import http from 'k6/http';
import { check } from 'k6';

export const options = {
  stages: [
    { duration: '10s', target: 100 },   // 10s: ุงูุฒุงุด ุจู 100 VU
    { duration: '20s', target: 300 },   // 20s: ุงูุฒุงุด ุจู 300 VU
    { duration: '20s', target: 0 },    // 20s: ฺฉุงูุด ุจู 0 VU
  ],
  thresholds: {
    http_req_failed: ['rate<0.01'],           // ฺฉูุชุฑ ุงุฒ 1% ุฎุทุง
    http_req_duration: ['p(95)<200'],         // 95% ุฒุฑ 200ms
  },
};

export default function () {
  const res = http.get('http://localhost:8080/hello');
  check(res, { '200': (r) => r.status === 200 });
  // ุชูุฌู: sleep ูุฌูุฏ ูุฏุงุฑุฏ
}
```

**ุชูุถุญ:**
- **Stages**: ุจุงุฑ ุจู ุตูุฑุช ูุฑุญููโุง ุงูุฒุงุด ูโุงุจุฏ
  - ูุฑุญูู 1: 10 ุซุงูู ุชุง 100 VU
  - ูุฑุญูู 2: 20 ุซุงูู ุชุง 300 VU
  - ูุฑุญูู 3: 20 ุซุงูู ุชุง 0 VU (cooldown)
- **ุจุฏูู sleep**: ูุฑ VU ุชุง ุญุฏ ุงูฺฉุงู ุณุฑุน ุฏุฑุฎูุงุณุช ูโุฒูุฏ
- **ูุชุฌู:** RPS ุฎูุฏ ุจู ุฎูุฏ ุจุงูุง ูโุฑูุฏ (ูุญุฏูุฏ ุจู CPU/Network)

**ุงุฌุฑุง:**
```bash
k6 run k6/02-hello-stages.js
```

**ุชุญูู ูุชุงุฌ:**

| ูุนุงุฑ | ููุฏุงุฑ ููุฑุฏ ุงูุชุธุงุฑ | ุชูุถุญ |
|-------|-------------------|-------|
| `http_req_failed` | < 1% | ูุฑุฎ ุฎุทุง ุจุงุฏ ูพุงู ุจุงุดุฏ |
| `http_req_duration p95` | < 200ms | 95% ุฏุฑุฎูุงุณุชโูุง ุจุงุฏ ุฒุฑ 200ms ุจุงุดูุฏ |
| `http_reqs/s` | ูุชุบุฑ | RPS ุจู ุชุนุฏุงุฏ VU ู latency ุจุณุชฺฏ ุฏุงุฑุฏ |

**ูฺฉุชู ููู:** ุฏุฑ ุงู ุชุณุชุ RPS ฺฉูุชุฑู ููโุดูุฏ. RPS ูุชุฌู ุชุนุฏุงุฏ VU ู ุณุฑุนุช ูพุงุณุฎ ุณุฑูุณ ุงุณุช. ุงฺฏุฑ ูโุฎูุงูุฏ RPS ุฑุง ฺฉูุชุฑู ฺฉูุฏุ ุจุงุฏ ุงุฒ `constant-arrival-rate` ุงุณุชูุงุฏู ฺฉูุฏ.

**ููุงุณู ุจุง ุชุณุช 1:**

| ูฺฺฏ | ุชุณุช 1 (Smoke) | ุชุณุช 2 (Stages) |
|-------|---------------|----------------|
| **VU** | 1 | 0 โ 100 โ 300 โ 0 |
| **Sleep** | โ (1s) | โ (ุจุฏูู sleep) |
| **RPS** | ~1 req/s | ูุชุบุฑ (ุชุง ฺูุฏ ูุฒุงุฑ) |
| **ูุฏู** | ุจุฑุฑุณ ุฏุณุชุฑุณ | ฺฏุฑูุชู baseline |
| **ูุฏุช ุฒูุงู** | 10s | 50s |

**ูุชุฌู:** ุชุณุช 2 ุจู ุดูุง ฺฉ baseline ูโุฏูุฏ ฺฉู ูโุชูุงูุฏ ุจุง ุชุณุชโูุง ุจุนุฏ ููุงุณู ฺฉูุฏ.

---

## 3. ูพุดโูุงุฒูุง

### ูุตุจ k6

ุจุฑุง ูุตุจ k6 ุฑู Ubuntu:

```bash
# ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ APT repository (ุชูุตู ูโุดูุฏ)
sudo apt-get update
sudo apt-get install -y gnupg ca-certificates curl

sudo rm -f /usr/share/keyrings/k6-archive-keyring.gpg
curl -fsSL https://dl.k6.io/key.gpg | gpg --dearmor | sudo tee /usr/share/keyrings/k6-archive-keyring.gpg > /dev/null
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" \
  | sudo tee /etc/apt/sources.list.d/k6.list

sudo apt-get update
sudo apt-get install -y k6

# ุจุฑุฑุณ ูุตุจ
k6 version
```

### ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ

ุจุฑุง ุงุฌุฑุง ุชุณุชุ ุณุฑูุณ ุจุงุฏ ุฏุฑ ุญุงู ุงุฌุฑุง ุจุงุดุฏ:

```bash
# ุฑูุด 1: ุงุฌุฑุง ูุญู (ุชูุตู ูโุดูุฏ ุจุฑุง ุชุณุช)
make dev-run

# ุฑูุด 2: ุงุฌุฑุง ุจุง Docker
make docker-up
```

**ูฺฉุชู:** ุจุฑุง ุชุณุช ุฏููโุชุฑุ ุชูุตู ูโุดูุฏ ุงุฒ ุงุฌุฑุง ูุญู (`make dev-run`) ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ููุงุจุน ุณุณุชู ุจู ุตูุฑุช ฺฉุงูู ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏ.

### ุฑูุดโูุง ุฏฺฏุฑ ูุตุจ k6

```bash
# ุฑูุด 2: ุงุณุชูุงุฏู ุงุฒ Snap
sudo apt update
sudo apt install -y snapd
sudo snap install k6

# ุฑูุด 3: ุงุณุชูุงุฏู ุงุฒ Docker
docker pull grafana/k6
docker run --rm -i grafana/k6 run - <k6/01-hello-smoke.js
```

---

## 4. ุณุณุชู ุชุญุช ุชุณุช (System Under Test - SUT)

### ฺุฑุง ูุดุฎุตุงุช ุณุณุชู ููู ุงุณุชุ

ูุดุฎุตุงุช ุณุณุชู ุจุฑุง ุชูุณุฑ ูุชุงุฌ ุชุณุช ุจุณุงุฑ ููู ุงุณุช ุฒุฑุง:
- **CPU** ูุญุฏูุฏุช ุงุตู ุฏุฑ ุชุณุชโูุง ูุญู ุงุณุช
- **RAM** ุฏุฑ ุตูุฑุช ฺฉูุจูุฏ ุจุงุนุซ swap ู ุงูุฒุงุด latency ูโุดูุฏ
- **OS** ู ุชูุธูุงุช ุดุจฺฉู ุจุฑ ุนููฺฉุฑุฏ ุชุฃุซุฑ ูโฺฏุฐุงุฑุฏ

### ุฌูุนโุขูุฑ ูุดุฎุตุงุช ุณุณุชู

ุจุฑุง ฺฏุฒุงุฑุด ู ุชูุณุฑ ูุชุงุฌุ ูุดุฎุตุงุช ุณุณุชู ุฑุง ุฌูุนโุขูุฑ ฺฉูุฏ:

```bash
# ุงุทูุงุนุงุช ุณุณุชู ุนุงูู
lsb_release -a || cat /etc/os-release

# ุงุทูุงุนุงุช CPU (ูุฏูุ ุชุนุฏุงุฏ ูุณุชู/ุชุฑุฏ)
lscpu

# ุงุทูุงุนุงุช RAM (ฺฉู/ุขุฒุงุฏ)
free -h

# ุงุทูุงุนุงุช ุฏุณฺฉ (ุงุฎุชุงุฑ)
df -h

# ุงุทูุงุนุงุช ุดุจฺฉู (ุงุฎุชุงุฑ)
ip a
```

### ุฌุฏูู ูุดุฎุตุงุช ุณุณุชู (ุจุฑุง ฺฏุฒุงุฑุด)

| ูุดุฎุตู | ููุฏุงุฑ |
|------|-------|
| **OS** | [ุฎุฑูุฌ `lsb_release -a`] |
| **CPU Model** | [ุงุฒ `lscpu`] |
| **CPU Cores** | [ุงุฒ `lscpu`] |
| **CPU Threads** | [ุงุฒ `lscpu`] |
| **Total RAM** | [ุงุฒ `free -h`] |
| **Available RAM** | [ุงุฒ `free -h`] |

**ูุซุงู:**
```bash
$ lscpu | grep -E "Model name|CPU\(s\)|Thread"
Model name:            Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz
CPU(s):                12
Thread(s) per core:    2

$ free -h
              total        used        free      shared  buff/cache   available
Mem:           16Gi       2.1Gi       8.5Gi       200Mi       5.4Gi        13Gi
```

---

## 5. ุงุณุชุฑุงุชฺ Threshold

### Threshold ฺุณุชุ

Threshold ุฏุฑ k6 ูุนุงุฑูุง ููููุช/ุดฺฉุณุช ุชุณุช ุฑุง ุชุนุฑู ูโฺฉูุฏ. ุงฺฏุฑ threshold ููุถ ุดูุฏุ ุชุณุช ุจู ุนููุงู failed ุนูุงูุชโฺฏุฐุงุฑ ูโุดูุฏ.

### ฺุฑุง Threshold ูุงุฒู ุงุณุชุ

- **ุชุนุฑู ูุนุงุฑ ููููุช:** ูุดุฎุต ูโฺฉูุฏ ฺู ูุชุงุฌ ูุงุจู ูุจูู ุงุณุช
- **ุชุดุฎุต ุฎูุฏฺฉุงุฑ ูุดฺฉู:** ุงฺฏุฑ threshold ููุถ ุดูุฏุ ูโุฏุงูู ุณุณุชู ูุดฺฉู ุฏุงุฑุฏ
- **ููุงุณู ูุชุงุฌ:** ุงูฺฉุงู ููุงุณู ูุชุงุฌ ุชุณุชโูุง ูุฎุชูู ุฑุง ูุฑุงูู ูโฺฉูุฏ

### ูุนุงุฑูุง ููู

#### 1. ูุฑุฎ ุฎุทุง (`http_req_failed`)

```javascript
http_req_failed: ['rate<0.01']  // ฺฉูุชุฑ ุงุฒ 1% ุฎุทุง
```

- **ูุนู:** ุฏุฑุตุฏ ุฏุฑุฎูุงุณุชโูุง ฺฉู ุจุง ุฎุทุง ููุงุฌู ุดุฏูโุงูุฏ
- **ูุฏู:** ุจุงุฏ ูุฒุฏฺฉ ุจู ุตูุฑ ุจุงุดุฏ (ุจุฑุง endpoint ุณุงุฏู ูุซู `/hello`)

#### 2. Latency - p95 (`http_req_duration`)

```javascript
http_req_duration: ['p(95)<50']  // 95% ุฏุฑุฎูุงุณุชโูุง ุฒุฑ 50ms
```

- **ูุนู:** 95% ุฏุฑุฎูุงุณุชโูุง ุจุงุฏ ุฒุฑ ุงู ููุฏุงุฑ ุจุงุดูุฏ
- **ูุฏู:** ุจุฑุง endpoint ุณุงุฏูุ ุจุงุฏ ุจุณุงุฑ ูพุงู ุจุงุดุฏ

#### 3. Latency - p99 (`http_req_duration`)

```javascript
http_req_duration: ['p(99)<150']  // 99% ุฏุฑุฎูุงุณุชโูุง ุฒุฑ 150ms
```

- **ูุนู:** 99% ุฏุฑุฎูุงุณุชโูุง ุจุงุฏ ุฒุฑ ุงู ููุฏุงุฑ ุจุงุดูุฏ
- **ูุฏู:** ูุดุงูโุฏููุฏู ุจุฏุชุฑู ุญุงูุชโูุง ุงุณุช

### ุฑูุด ุชุนู Threshold: Baseline โ Target โ Adjustment

#### ูุฑุญูู A: Baseline ฺฏุฑูุชู

ุงุจุชุฏุง ฺฉ baseline ุจุฏูู ูุดุงุฑ ุจฺฏุฑุฏ:

```bash
# ุชุณุช ุจุง 1 VU ุจุฑุง 30 ุซุงูู
k6 run --vus 1 --duration 30s k6/03-hello-concurrency-no-sleep.js
```

**ูุชุฌู:** baseline latency ุฑุง ูโุฏูุฏ (ูุซูุงู p95 โ 2ms)

**ูฺฉุชู:** ุงฺฏุฑ baseline ุดูุง p95 โ 2ms ุงุณุชุ threshold `p(95)<200ms` ุฎู ฺฏุดุงุฏ ุงุณุช ู ูฺโููุช fail ููโุดูุฏ.

#### ูุฑุญูู B: ุชุนู ูุฏู ฺฉุงุฑุจุฑุฏ

ุฏู ุญุงูุช ุฑุงุฌ:

**ุญุงูุช 1 (ูุญุตููโูุญูุฑ):**
- SLA/ูุฏู ูุญุตูู ูุดุฎุต ุงุณุช: ูุซูุงู p95 ุฒุฑ 50msุ ุฎุทุง ุฒุฑ 1%
- ุงุฒ ุงู ููุงุฏุฑ ุงุณุชูุงุฏู ฺฉูุฏ

**ุญุงูุช 2 (ููุท ุธุฑูุช ูุญู):**
- ูุฏู: ูพุฏุง ฺฉุฑุฏู "ููุทู ุดฺฉุณุช"
- Thresholdูุง ุฑุง ูุซู "ุฎุท ุชููู" ุชูุธู ฺฉูุฏ:
  - `error < 2%`
  - `p95 < 200ms`
- ุงู ุจู ูุนู "ฺฉูุช" ูุณุชุ ุจู ูุนู "ุงุฒ ุงูุฌุง ุจู ุจุนุฏ ุบุฑูุงุจู ุงุชฺฉุง ุงุณุช"

#### ูุฑุญูู C: ูุณุจุช ุจู ููุงุจุน ุณุณุชู ูุนูุงุฏุงุฑ ฺฉุฑุฏู

ุฑู ููฺฉุงู ูุนูููุงู:
- ุชุง ููุช CPU ุฒุฑ ~70% ุงุณุชุ latency ุฎูุจ ุงุณุช
- ุงุฒ ฺฉ ููุทู ุจู ุจุนุฏ CPU ุงุดุจุงุน ูโุดูุฏ ู p95/p99 ููุง ุจุงูุง ูโุฑูุฏ

**ูพุดููุงุฏ ุนูู ุจุฑุง ุดุฑูุน:**

ุจุฑุง endpoint ุณุงุฏู ูุซู `/hello` ุฑู ููฺฉุงู:

```javascript
thresholds: {
  http_req_failed: ['rate<0.01'],           // 1% ุฎุทุง
  http_req_duration: ['p(95)<50', 'p(99)<150'],  // p95 < 50ms, p99 < 150ms
}
```

**ูฺฉุชู:** ุงู ููุงุฏุฑ ุฑุง ุจุง ุฏุงุฏู ูุงูุน ุฎูุฏุชุงู ุงุตูุงุญ ฺฉูุฏ.

---

## 5. ุชุณุช ุจุงุฑ ููุฒูุงู (ุจุฏูู Sleep)

### ุฑูุชุงุฑ Virtual User ุจุฏูู Sleep

ููุช `sleep` ุญุฐู ูโุดูุฏุ ูุฑ VU ุงู ฺฉุงุฑ ุฑุง ูโฺฉูุฏ:
- **ูพุดุช ุณุฑ ูู ุฏุฑุฎูุงุณุช ูโุฒูุฏ** (as fast as possible)
- **ุจุฏูู ุชููู** ุจู ุฏุฑุฎูุงุณุชโูุง
- **RPS ุฎูุฏ ุจู ุฎูุฏ ุจุงูุง ูโุฑูุฏ** ุชุง ูุญุฏูุฏุช ุณุณุชู

### ฺุฑุง ุงู ุชุณุช Contention ู Saturation ุฑุง ูุดุงู ูโุฏูุฏุ

ุงู ุชุณุช:
- **CPU ุฑุง ุงุดุจุงุน ูโฺฉูุฏ:** ุชุง ุฌุง ฺฉู CPU ุจู 100% ุจุฑุณุฏ
- **Lock contention ุฑุง ูุดุงู ูโุฏูุฏ:** ุงฺฏุฑ lock contention ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ
- **Scheduler pressure ุฑุง ูุดุงู ูโุฏูุฏ:** ูุดุงุฑ ุฑู scheduler ุณุณุชู
- **Network stack ุฑุง ุชุณุช ูโฺฉูุฏ:** ูุดุงุฑ ุฑู network stack

### ุงู ุชุณุช ฺู ฺุฒ ุฑุง ุงูุฏุงุฒูโฺฏุฑ ูโฺฉูุฏ ู ฺู ฺุฒ ุฑุง ููโฺฉูุฏุ

**ุงูุฏุงุฒูโฺฏุฑ ูโฺฉูุฏ:**
- โ ุธุฑูุช ุญุฏุงฺฉุซุฑ ุณุณุชู (maximum capacity)
- โ ููุทู ุดฺฉุณุช (breaking point)
- โ ุฑูุชุงุฑ ุณุณุชู ุชุญุช ูุดุงุฑ ุฎุงูุต
- โ ูุญุฏูุฏุชโูุง CPU ู scheduler

**ุงูุฏุงุฒูโฺฏุฑ ููโฺฉูุฏ:**
- โ ุฑูุชุงุฑ ูุงูุน ฺฉุงุฑุจุฑุงู (ฺฉู ุจู ุฏุฑุฎูุงุณุชโูุง ูุงุตูู ุฏุงุฑูุฏ)
- โ ุธุฑูุช ูพุงุฏุงุฑ (sustained capacity)
- โ ุฑูุชุงุฑ ุณุณุชู ุชุญุช ุจุงุฑ ูุงูุน

**ุฎูุงุตู:** ุงู ุชุณุช ูโฺฏูุฏ "ุฏุฑ ุญุงูุช ูุดุงุฑ ุฎุงูุต ู ุบุฑูุงูุนุ ุณูู throughput+concurrency ุงู ุณุณุชู ฺูุฏุฑ ุงุณุชุ"

### ฺุฑุง ุงู ุชุณุช ููู ุงุณุชุ

ุงู ุชุณุช (ุชุณุช ุดูุงุฑู 3) ุงุฏุงูู ููุทู ุชุณุชโูุง ูุจู ุงุณุช:
- **ุชุณุช 1 (Smoke)**: ุงุทููุงู ุงุฒ ุฏุณุชุฑุณ ุณุฑูุณ
- **ุชุณุช 2 (Stages)**: ฺฏุฑูุชู baseline ุจุง ramp-up ุณุงุฏู
- **ุชุณุช 3 (Concurrency No Sleep)**: ูพุฏุง ฺฉุฑุฏู ุธุฑูุช ุญุฏุงฺฉุซุฑ ุจุง ramp-up ุฏููโุชุฑ

**ุชูุงูุช ุจุง ุชุณุช 2:**
- ุชุณุช 2: ramp-up ุณุฑุน (10s โ 100 VU)
- ุชุณุช 3: ramp-up ุชุฏุฑุฌโุชุฑ (10s โ 50, 20s โ 100, 20s โ 200, 20s โ 300)
- ุชุณุช 3: thresholdูุง ุฏููโุชุฑ (p95 < 50ms, p99 < 150ms)

---

## 7. ุชูุถุญ ุงุณฺฉุฑูพุช ุชุณุช

ุงุณฺฉุฑูพุช ุชุณุช ุฏุฑ ูุงู `k6/03-hello-concurrency-no-sleep.js` ูุฑุงุฑ ุฏุงุฑุฏ:

```javascript
import http from 'k6/http';
import { check } from 'k6';

export const options = {
  stages: [
    { duration: '10s', target: 50 },   // 10 ุซุงูู: ุงูุฒุงุด ุจู 50 VU
    { duration: '20s', target: 100 },   // 20 ุซุงูู: ุงูุฒุงุด ุจู 100 VU
    { duration: '20s', target: 200 },   // 20 ุซุงูู: ุงูุฒุงุด ุจู 200 VU
    { duration: '20s', target: 300 },   // 20 ุซุงูู: ุงูุฒุงุด ุจู 300 VU
    { duration: '10s', target: 0 },     // 10 ุซุงูู: ฺฉุงูุด ุจู 0 VU (cooldown)
  ],
  thresholds: {
    http_req_failed: ['rate<0.01'],           // ฺฉูุชุฑ ุงุฒ 1% ุฎุทุง
    http_req_duration: ['p(95)<50', 'p(99)<150'],  // p95 < 50ms, p99 < 150ms
  },
};

export default function () {
  const res = http.get('http://localhost:8080/hello');
  check(res, { 'status 200': (r) => r.status === 200 });
  // ุชูุฌู: sleep ูุฌูุฏ ูุฏุงุฑุฏ - ูุฑ VU ุชุง ุญุฏ ุงูฺฉุงู ุณุฑุน ุฏุฑุฎูุงุณุช ูโุฒูุฏ
}
```

### ุชูุถุญ Configuration

#### Stages (ูุฑุงุญู ุงูุฒุงุด ุจุงุฑ)

| ูุฑุญูู | ูุฏุช ุฒูุงู | ุชุนุฏุงุฏ VU | ุชูุถุญ |
|-------|----------|----------|-------|
| 1 | 10s | 0 โ 50 | ฺฏุฑูโฺฉุฑุฏู (warm-up) |
| 2 | 20s | 50 โ 100 | ุงูุฒุงุด ุจุงุฑ |
| 3 | 20s | 100 โ 200 | ุงูุฒุงุด ุจุดุชุฑ |
| 4 | 20s | 200 โ 300 | ุงูุฒุงุด ุชุง ุญุฏุงฺฉุซุฑ |
| 5 | 10s | 300 โ 0 | ุฎูฺฉโฺฉุฑุฏู (cooldown) |

**ฺฉู ุฒูุงู ุชุณุช:** 80 ุซุงูู

#### Thresholds

- **`http_req_failed < 1%`:** ูุฑุฎ ุฎุทุง ุจุงุฏ ฺฉูุชุฑ ุงุฒ 1% ุจุงุดุฏ
- **`p95 < 50ms`:** 95% ุฏุฑุฎูุงุณุชโูุง ุจุงุฏ ุฒุฑ 50ms ุจุงุดูุฏ
- **`p99 < 150ms`:** 99% ุฏุฑุฎูุงุณุชโูุง ุจุงุฏ ุฒุฑ 150ms ุจุงุดูุฏ

**ูฺฉุชู:** ุงู ููุงุฏุฑ ุฑุง ุจุง ุชูุฌู ุจู ุณุณุชู ู baseline ุฎูุฏุชุงู ุชูุธู ฺฉูุฏ.

---

## 8. ูุญูู ุงุฌุฑุง ุชุณุช

### ุฏุณุชูุฑ ุงุฌุฑุง

```bash
k6 run k6/03-hello-concurrency-no-sleep.js
```

### ฺู ฺุฒ ุฑุง ุฏุฑ ุญู ุงุฌุฑุง ูุงูุชูุฑ ฺฉููุ

#### 1. CPU ู RAM ุณุณุชู

ุฏุฑ ฺฉ terminal ุฌุฏุงฺฏุงูู:

```bash
# ูุงูุชูุฑูฺฏ ฺฉู ุณุณุชู
htop

# ุง ูุงูุชูุฑูฺฏ CPU/RAM
watch -n 1 'top -bn1 | head -20'
```

**ฺุฒูุง ฺฉู ุจุงุฏ ุจุฑุฑุณ ฺฉูุฏ:**
- **CPU Usage:** ุขุง CPU ุจู 100% ูโุฑุณุฏุ
- **CPU per Process:** ุจุดุชุฑ CPU ุฑู k6 ุงุณุช ุง ุณุฑูุณ Goุ
- **RAM Usage:** ุขุง RAM/Swap ุฏุฑฺฏุฑ ุงุณุชุ (ุงฺฏุฑ ุจููุ latency ุจุงูุง ูโุฑูุฏ)

#### 2. ูุงูุชูุฑูฺฏ ุฏููโุชุฑ Process

```bash
# ูพุฏุง ฺฉุฑุฏู PID
pidof k6
pidof go-backend-service  # ุง ูุงู binary ุดูุง

# ูุงูุชูุฑูฺฏ ฺฉ process ุฎุงุต
pidstat -p <PID> 1
```

#### 3. ุฎุฑูุฌ k6

ุฏุฑ terminal ฺฉู k6 ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุชุ ุจู ุงู ููุงุฑุฏ ุชูุฌู ฺฉูุฏ:
- **RPS (http_reqs/s):** ุขุง RPS ุฏฺฏุฑ ุฑุดุฏ ููโฺฉูุฏุ
- **Latency (p95/p99):** ุขุง latency ูุงฺฏูุงู ุจุงูุง ูโุฑูุฏุ
- **Error rate:** ุขุง error rate ุดุฑูุน ุจู ุงูุฒุงุด ูโฺฉูุฏุ

### ูุซุงู ุฎุฑูุฌ

```
     โ status 200
     โ http_req_duration: p(95)<50
     โ http_req_duration: p(99)<150

     checks.........................: 100.00% โ 125000    โ 0
     data_received..................: 2.1 MB  26 kB/s
     data_sent......................: 15 MB   188 kB/s
     http_req_duration..............: avg=45.2ms min=0.5ms med=2.1ms max=850ms p(90)=120ms p(95)=180ms p(99)=450ms
     http_req_failed................: 0.00%   โ 0         โ 0
     http_reqs.....................: 125000  1562.5/s
     iteration_duration.............: avg=45.3ms min=0.5ms med=2.1ms max=850ms
     vus............................: 300     min=0       max=300
     vus_max........................: 300     min=0       max=300
```

---

## 9. ุดูุงุณุง ุญุฏ ุธุฑูุช (Capacity Limit)

### ฺฺฏููู ุญุฏ ุธุฑูุช ุฑุง ุดูุงุณุง ฺฉููุ

ุญุฏ ุธุฑูุช ุฌุง ุงุณุช ฺฉู ุณุณุชู ุฏฺฏุฑ ููโุชูุงูุฏ ุจุงุฑ ุจุดุชุฑ ุฑุง ุชุญูู ฺฉูุฏ. ุงู ุฑุง ูโุชูุงู ุงุฒ ฺูุฏ ูุดุงูู ุชุดุฎุต ุฏุงุฏ:

### 1. ุฑุดุฏ Latency (Latency Growth)

**ูุดุงูู:**
- p95/p99 ุจู ุตูุฑุช **ููุง** ุจุงูุง ูโุฑูุฏ
- ุงุฒ ฺฉ ููุทู ุจู ุจุนุฏุ latency ฺูุฏ ุจุฑุงุจุฑ ูโุดูุฏ

**ูุซุงู:**
```
VU=100: p95=5ms,  p99=10ms
VU=200: p95=15ms, p99=30ms
VU=300: p95=180ms, p99=450ms  โ ุงูุฌุง ุณุณุชู ฺฉู ุขูุฑุฏู
```

**ูฺฉุชู:** ุงฺฏุฑ p95 ุงุฒ 50ms ุจู 200ms ูโุฑูุฏุ ุงุญุชูุงูุงู ุจู ุญุฏ ุธุฑูุช ุฑุณุฏูโุงุฏ.

### 2. ูุฑุฎ ุฎุทุง (Error Rate)

**ูุดุงูู:**
- `http_req_failed` ุดุฑูุน ุจู ุงูุฒุงุด ูโฺฉูุฏ
- ุฎุทุงูุง timeout ุง connection error ุธุงูุฑ ูโุดููุฏ

**ูุซุงู:**
```
VU=100: http_req_failed=0.00%
VU=200: http_req_failed=0.01%
VU=300: http_req_failed=2.5%  โ ุงูุฌุง ูุดฺฉู ุฏุงุฑู
```

### 3. ุณูู RPS (RPS Plateau)

**ูุดุงูู:**
- RPS ุฏฺฏุฑ ุฑุดุฏ ููโฺฉูุฏ
- ุจุง ุงูุฒุงุด VUุ RPS ุซุงุจุช ูโูุงูุฏ ุง ุญุช ฺฉุงูุด ูโุงุจุฏ
- ุงูุง latency ู errors ุจุงูุง ูโุฑููุฏ

**ูุซุงู:**
```
VU=100:  RPS=2000/s, p95=5ms
VU=200:  RPS=3500/s, p95=15ms
VU=300:  RPS=3500/s, p95=180ms  โ RPS ุฏฺฏุฑ ุฑุดุฏ ููโฺฉูุฏ
VU=400:  RPS=3400/s, p95=450ms  โ ุญุช ฺฉุงูุด ุงูุชู
```

**ูฺฉุชู:** ุงฺฏุฑ RPS ุฏฺฏุฑ ุฑุดุฏ ููโฺฉูุฏ ูู VU ุงูุฒุงุด ูโุงุจุฏุ ุจู ุณูู ุฑุณุฏูโุงุฏ.

### 4. ุงุดุจุงุน CPU (CPU Saturation)

**ูุดุงูู:**
- CPU ุจู 100% ูโุฑุณุฏ
- CPU ุฏฺฏุฑ ููโุชูุงูุฏ ุจุดุชุฑ ฺฉุงุฑ ฺฉูุฏ

**ุจุฑุฑุณ:**
```bash
# ุฏุฑ terminal ุฌุฏุงฺฏุงูู
htop
# ุง
top
```

**ูฺฉุชู:** ุงฺฏุฑ CPU ฺฉูุงูุช (k6) ุจู 100% ุฑุณุฏุ ููฺฉู ุงุณุช ูุญุฏูุฏุช ุงุฒ ุณูุช k6 ุจุงุดุฏ ูู ุณุฑูุณ.

### ุฎูุงุตู: ูุนุงุฑูุง ุดูุงุณุง ุญุฏ ุธุฑูุช

| ูุนุงุฑ | ูุดุงูู ุญุฏ ุธุฑูุช |
|-------|----------------|
| **Latency** | p95/p99 ุจู ุตูุฑุช ููุง ุจุงูุง ูโุฑูุฏ |
| **Error Rate** | ุดุฑูุน ุจู ุงูุฒุงุด ูโฺฉูุฏ (>1%) |
| **RPS** | ุฏฺฏุฑ ุฑุดุฏ ููโฺฉูุฏ (plateau) |
| **CPU** | ุจู 100% ูโุฑุณุฏ |

**ูฺฉุชู ููู:** ุงฺฏุฑ ููู ุงู ูุดุงููโูุง ููุฒูุงู ุธุงูุฑ ุดููุฏุ ุจู ูุถูุญ ุจู ุญุฏ ุธุฑูุช ุฑุณุฏูโุงุฏ.

---

## 10. ูุชุงุฌ - ุธุฑูุช ุญุฏุงฺฉุซุฑ ูุดุงูุฏู ุดุฏู

### ูุชุงุฌ ุชุณุชโูุง ุงูุฌุงู ุดุฏู

ุฏุฑ ุงู ุจุฎุด ูุชุงุฌ ุฏู ุชุณุช ูุฎุชูู ุจุง configurationูุง ูุชูุงูุช ุงุฑุงุฆู ุดุฏู ุงุณุช:

#### ุชุณุช 1: Ramp-up ุชุง 300 VU

**Configuration:**
```javascript
stages: [
  { duration: '10s', target: 50 },   // 10s: ุงูุฒุงุด ุจู 50 VU (warm-up)
  { duration: '20s', target: 100 },  // 20s: ุงูุฒุงุด ุจู 100 VU
  { duration: '20s', target: 200 },  // 20s: ุงูุฒุงุด ุจู 200 VU
  { duration: '20s', target: 300 },  // 20s: ุงูุฒุงุด ุจู 300 VU
  { duration: '10s', target: 0 },     // 10s: ฺฉุงูุด ุจู 0 VU (cooldown)
]
```

**ุณุณุชู ุชุญุช ุชุณุช:**
- **CPU:** Intel i7-7700 (8 threads)
- **RAM:** 16GB
- **OS:** Ubuntu 24.04
- **ุงุฌุฑุง:** ูุญู (local)

**ูุชุงุฌ:**

| ูุนุงุฑ | ููุฏุงุฑ | ูุถุนุช |
|-------|------|-------|
| **ุญุฏุงฺฉุซุฑ VU** | 299 | - |
| **RPS ูุชูุณุท** | ~11,104 req/s | โ |
| **ฺฉู ุฏุฑุฎูุงุณุชโูุง** | 888,453 | - |
| **ูุฏุช ุฒูุงู** | 80s (1m20s) | - |
| **p95 latency** | 38.47ms | โ ุฒุฑ threshold (50ms) |
| **p99 latency** | 65.66ms | โ ุฒุฑ threshold (150ms) |
| **avg latency** | 12.05ms | โ |
| **median latency** | 7.61ms | โ |
| **max latency** | 203.58ms | โ๏ธ |
| **ูุฑุฎ ุฎุทุง** | 0.00% | โ |
| **CPU Usage** | 100% | โ๏ธ ุงุดุจุงุน ุดุฏู |

**Thresholds:**

| Threshold | ููุฏุงุฑ ูุงูุน | ูุถุนุช |
|-----------|-------------|-------|
| `p(95)<50` | 38.47ms | โ Pass |
| `p(99)<150` | 65.66ms | โ Pass |
| `rate<0.01` | 0.00% | โ Pass |

**ุชูุณุฑ:**
- โ ุณุณุชู ุฏุฑ ูุดุงุฑ ุจุงูุง ุณุงูู ูโูุงูุฏ (0% error)
- โ Latency ุฏุฑ ูุญุฏูุฏู ูุงุจู ูุจูู ุงุณุช (p95 < 50ms)
- โ๏ธ CPU ุจู 100% ุฑุณุฏูุ ูพุณ ุงู RPS ุงุญุชูุงูุงู "ุณูู ุชูุงู ุงู ูุงุดู" ุงุณุช
- ๐ ุงู ุนุฏุฏ (~11k RPS) ุจุดุชุฑ "ุณูู ุชูุงู ุงู ูุงุดู ุฏุฑ ุงู ุชุณุช" ุงุณุช ุชุง "ุณูู ุชูุงู ุณุฑูุณ"

**ูุชุฌู:** ุชุณุช **Pass** ุดุฏ - ููู thresholdูุง ุฑุนุงุช ุดุฏูุฏ.

---

#### ุชุณุช 2: Ramp-up ุชุง 600 VU

**Configuration:**
```javascript
stages: [
  { duration: '10s', target: 100 },   // 10s: ุงูุฒุงุด ุจู 100 VU
  { duration: '20s', target: 200 },    // 20s: ุงูุฒุงุด ุจู 200 VU
  { duration: '20s', target: 400 },   // 20s: ุงูุฒุงุด ุจู 400 VU
  { duration: '20s', target: 600 },   // 20s: ุงูุฒุงุด ุจู 600 VU
  { duration: '10s', target: 0 },     // 10s: ฺฉุงูุด ุจู 0 VU (cooldown)
]
```

**ุณุณุชู ุชุญุช ุชุณุช:**
- **CPU:** Intel i7-7700 (8 threads)
- **RAM:** 16GB
- **OS:** Ubuntu 24.04
- **ุงุฌุฑุง:** ูุญู (local)

**ูุชุงุฌ:**

| ูุนุงุฑ | ููุฏุงุฑ | ูุถุนุช |
|-------|------|-------|
| **ุญุฏุงฺฉุซุฑ VU** | 600 | - |
| **RPS ูุชูุณุท** | ~13,055 req/s | โ (18% ุจุดุชุฑ ุงุฒ ุชุณุช 1) |
| **p95 latency** | 65.83ms | โ ุงุฒ threshold ุฑุฏ ุดุฏู (50ms) |
| **p99 latency** | 114.77ms | โ ุฒุฑ threshold (150ms) |
| **avg latency** | 20.15ms | โ๏ธ (67% ุจุดุชุฑ ุงุฒ ุชุณุช 1) |
| **median latency** | 12.6ms | โ |
| **max latency** | ~286ms | โ๏ธ |
| **ูุฑุฎ ุฎุทุง** | 0.00% | โ |
| **CPU Usage** | 100% | โ๏ธ ุงุดุจุงุน ุดุฏู |

**Thresholds:**

| Threshold | ููุฏุงุฑ ูุงูุน | ูุถุนุช |
|-----------|-------------|-------|
| `p(95)<50` | 65.83ms | โ **Fail** (15.83ms ุจุดุชุฑ) |
| `p(99)<150` | 114.77ms | โ Pass |
| `rate<0.01` | 0.00% | โ Pass |

**ุชูุณุฑ:**

**ููุงุณู ุจุง ุชุณุช 1:**

| ูุนุงุฑ | ุชุณุช 1 (300 VU) | ุชุณุช 2 (600 VU) | ุชุบุฑ |
|-------|----------------|----------------|-------|
| **RPS** | ~11.1k | ~13.1k | +18% โ |
| **p95** | 38.47ms | 65.83ms | +71% โ |
| **p99** | 65.66ms | 114.77ms | +75% โ๏ธ |
| **avg** | 12.05ms | 20.15ms | +67% โ๏ธ |
| **Error** | 0% | 0% | ุจุฏูู ุชุบุฑ โ |

**ุชุญูู:**

1. **ุงูุฒุงุด RPS:** ุจุง ุฏู ุจุฑุงุจุฑ ฺฉุฑุฏู VU (300 โ 600)ุ RPS ููุท 18% ุงูุฒุงุด ุงูุช. ุงู ูุดุงู ูโุฏูุฏ:
   - ุณุณุชู ุจู ุณูู throughput ูุฒุฏฺฉ ุดุฏู
   - ูุฑ VU ุงุถุงู ุณูุฏ ฺฉูุชุฑ ุฏุงุฑุฏ

2. **ุงูุฒุงุด Latency:** p95 ุงุฒ 38ms ุจู 66ms ุฑุณุฏ (71% ุงูุฒุงุด):
   - ุงู ุงูฺฏู ฺฉูุงุณฺฉ "ุงุดุจุงุน CPU / contention" ุงุณุช
   - ุจุนุฏ ุงุฒ ฺฉ ููุทูุ ูุฑ VU ุงุถุงู ุจุดุชุฑ latency ุฑุง ุงูุฒุงุด ูโุฏูุฏ ุชุง RPS

3. **ููุทู ฺฉูุช:** ุจุง threshold `p95<50ms`:
   - ุธุฑูุช ูุงุจู ูุจูู ุฌุง ุจู 300 ุชุง 600 VU ุงุณุช
   - ุงุญุชูุงูุงู ุจู 400 ุชุง 600 VU ููุทู ุนุจูุฑ ุฑุฎ ุฏุงุฏู

4. **ุณุณุชู ูููุฒ ุณุงูู ุงุณุช:**
   - 0% error rate
   - ููู ุฏุฑุฎูุงุณุชโูุง ุจุง status 200 ูพุงุณุฎ ุฏุงุฏูโุงูุฏ
   - ููุท ฺฉูุช latency (p95) ุงุฒ ุงุณุชุงูุฏุงุฑุฏ ุชุนู ุดุฏู ุนุจูุฑ ฺฉุฑุฏู

**ูุชุฌู:** ุชุณุช **Fail** ุดุฏ - threshold `p(95)<50` ููุถ ุดุฏ.

**ูพุงู k6:**
```
thresholds on metrics 'http_req_duration' have been crossed
```

**ุฎูุงุตู ฺฉโุฎุท ุจุฑุง ฺฏุฒุงุฑุด ุชู:**

> On local Ubuntu 24.04 (i7-7700, 16GB RAM), `/hello` sustained ~13.1k RPS at 600 max VUs with 0% errors; however p95 latency degraded to ~66ms (threshold p95<50ms crossed).

---

### ููุงุณู ุฏู ุชุณุช

| ูฺฺฏ | ุชุณุช 1 (300 VU) | ุชุณุช 2 (600 VU) |
|-------|----------------|----------------|
| **ุญุฏุงฺฉุซุฑ VU** | 300 | 600 |
| **RPS** | ~11.1k | ~13.1k (+18%) |
| **p95** | 38.47ms โ | 65.83ms โ |
| **p99** | 65.66ms โ | 114.77ms โ |
| **Error Rate** | 0% โ | 0% โ |
| **Threshold Status** | โ Pass | โ Fail (p95) |
| **CPU** | 100% | 100% |

**ูุชุฌูโฺฏุฑ:**

1. **ุธุฑูุช ูพุงุฏุงุฑ (ุจุง ฺฉูุช):** ุชุง 300 VUุ ุณุณุชู ูพุงุฏุงุฑ ุงุณุช ู ููู thresholdูุง pass ูโุดููุฏ
2. **ููุทู ุดฺฉุณุช ฺฉูุช:** ุจู 300 ุชุง 600 VUุ p95 ุงุฒ threshold ุฑุฏ ูโุดูุฏ
3. **ุญุฏุงฺฉุซุฑ ุธุฑูุช:** ุฏุฑ 600 VUุ RPS ุจู ~13k ูโุฑุณุฏ ุงูุง ฺฉูุช latency ฺฉุงูุด ูโุงุจุฏ
4. **ูุญุฏูุฏุช:** CPU ุฏุฑ ูุฑ ุฏู ุชุณุช ุจู 100% ูโุฑุณุฏุ ูพุณ bottleneck ุงุญุชูุงูุงู CPU ุงุณุช

**ุชูุตู:**

- ุจุฑุง **ฺฉูุช ูพุงุฏุงุฑ:** ุญุฏุงฺฉุซุฑ 300 VU (ุง ฺฉูุชุฑ)
- ุจุฑุง **ุญุฏุงฺฉุซุฑ throughput:** ุชุง 600 VU (ุจุง ูุจูู ฺฉุงูุด ฺฉูุช latency)
- ุจุฑุง **ูุชุงุฌ ุฏููโุชุฑ:** k6 ุฑุง ุฑู ูุงุดู ุฌุฏุงฺฏุงูู ุงุฌุฑุง ฺฉูุฏ

---

### ุฌุฏูู ูุชุงุฌ (ุจุฑุง ูพุฑ ฺฉุฑุฏู ุจุนุฏ ุงุฒ ุงุฌุฑุง)

| ูุนุงุฑ | ููุฏุงุฑ | ุชูุถุญ |
|-------|------|-------|
| **ุญุฏุงฺฉุซุฑ VU ูููู** | | ุขุฎุฑู VU ฺฉู ููู thresholdูุง pass ุดุฏูุฏ |
| **ุญุฏุงฺฉุซุฑ RPS** | | ุจุดุชุฑู RPS ูุดุงูุฏู ุดุฏู |
| **p95 ุฏุฑ ุญุฏุงฺฉุซุฑ VU** | | p95 latency ุฏุฑ ุญุฏุงฺฉุซุฑ VU ูููู |
| **p99 ุฏุฑ ุญุฏุงฺฉุซุฑ VU** | | p99 latency ุฏุฑ ุญุฏุงฺฉุซุฑ VU ูููู |
| **ูุฑุฎ ุฎุทุง ุฏุฑ ุญุฏุงฺฉุซุฑ VU** | | ุฏุฑุตุฏ ุฎุทุง ุฏุฑ ุญุฏุงฺฉุซุฑ VU ูููู |
| **CPU Usage ุฏุฑ ุญุฏุงฺฉุซุฑ VU** | | ุฏุฑุตุฏ ุงุณุชูุงุฏู CPU (ุณุฑูุณ + k6) |
| **ููุทู ุดฺฉุณุช (VU)** | | ุงููู VU ฺฉู thresholdูุง fail ุดุฏูุฏ |
| **RPS ุฏุฑ ููุทู ุดฺฉุณุช** | | RPS ุฏุฑ ููุทู ุดฺฉุณุช |
| **p95 ุฏุฑ ููุทู ุดฺฉุณุช** | | p95 latency ุฏุฑ ููุทู ุดฺฉุณุช |
| **p99 ุฏุฑ ููุทู ุดฺฉุณุช** | | p99 latency ุฏุฑ ููุทู ุดฺฉุณุช |

**ูฺฉุชู:** ุจุฑุง ุฌุฒุฆุงุช ฺฉุงูู ูุชุงุฌ ุฏู ุชุณุช ุงูุฌุงู ุดุฏูุ ุจู ุจุฎุด "ูุชุงุฌ ุชุณุชโูุง ุงูุฌุงู ุดุฏู" ุฏุฑ ุจุงูุง ูุฑุงุฌุนู ฺฉูุฏ.

---

## 11. ูฺฉุงุช ู ูุญุฏูุฏุชโูุง

### ูุญุฏูุฏุชโูุง ุชุณุช ูุญู

#### 1. ูุญุฏูุฏุช ููุงุจุน ุณุณุชู

ููุช ูู k6 ู ูู ุณุฑูุณ Go ุฑู ฺฉ ุณุณุชู ุงุฌุฑุง ูโุดููุฏ:
- **CPU ูุดุชุฑฺฉ:** k6 ู ุณุฑูุณ ุจุฑุง CPU ุฑูุงุจุช ูโฺฉููุฏ
- **RAM ูุดุชุฑฺฉ:** ุงฺฏุฑ RAM ฺฉู ุจุงุดุฏุ swap ูุนุงู ูโุดูุฏ ู latency ุจุงูุง ูโุฑูุฏ
- **Network stack ูุดุชุฑฺฉ:** network stack ููฺฉู ุงุณุช bottleneck ุดูุฏ

**ุฑุงู ุญู:** ุจุฑุง ูุชุงุฌ ุฏููโุชุฑุ k6 ุฑุง ุฑู ุณุณุชู ุฌุฏุงฺฏุงูู ุงุฌุฑุง ฺฉูุฏ.

#### 2. ูุญุฏูุฏุช ุณูุช ฺฉูุงูุช (k6)

ููฺฉู ุงุณุช ูุจู ุงุฒ ุงูฺฉู ุณุฑูุณ ฺฉู ุจุงูุฑุฏุ **ุฎูุฏ k6** ูุญุฏูุฏ ุดูุฏ:
- CPU ฺฉูุงูุช ุจู 100% ูโุฑุณุฏ
- Network stack ฺฉูุงูุช ุงุดุจุงุน ูโุดูุฏ

**ุดูุงุณุง:** ุงฺฏุฑ CPU ฺฉูุงูุช (k6) ุจู 100% ุฑุณุฏ ูู CPU ุณุฑูุณ ุฒุฑ 100% ุงุณุชุ ูุญุฏูุฏุช ุงุฒ ุณูุช k6 ุงุณุช.

**ุฑุงู ุญู:**
- k6 ุฑุง ุฑู ุณุณุชู ููโุชุฑ ุงุฌุฑุง ฺฉูุฏ
- ุง ุงุฒ distributed k6 ุงุณุชูุงุฏู ฺฉูุฏ

#### 3. ุชุณุช ุบุฑูุงูุน

ุงู ุชุณุช (ุจุฏูู sleep) **ุบุฑูุงูุน** ุงุณุช:
- ฺฉุงุฑุจุฑุงู ูุงูุน ุจู ุฏุฑุฎูุงุณุชโูุง ูุงุตูู ุฏุงุฑูุฏ
- ุงู ุชุณุช ููุท "ุธุฑูุช ุญุฏุงฺฉุซุฑ" ุฑุง ูุดุงู ูโุฏูุฏุ ูู "ุธุฑูุช ูพุงุฏุงุฑ"

**ุฑุงู ุญู:** ุจุฑุง ุชุณุช ูุงูุนโุชุฑุ ุงุฒ ุชุณุชโูุง RPS-based ุงุณุชูุงุฏู ฺฉูุฏ (ูุซู `constant-arrival-rate`).

### ูุญุฏูุฏุชโูุง ุฏฺฏุฑ

#### 4. Network Latency

ุฏุฑ ุชุณุช ูุญู (`localhost`):
- Network latency ุชูุฑุจุงู ุตูุฑ ุงุณุช
- ุฏุฑ productionุ network latency ุชุฃุซุฑ ูโฺฏุฐุงุฑุฏ

#### 5. ุณุงุฑ ุณุฑูุณโูุง

ุฏุฑ ุชุณุช ูุญู:
- ููุท endpoint `/hello` ุชุณุช ูโุดูุฏ
- ุฏุฑ productionุ ุณุงุฑ endpointโูุง ู ุณุฑูุณโูุง ูู ุจุงุฑ ุฏุงุฑูุฏ

### ุชูุตูโูุง

1. **ุจุฑุง ุชุณุช ุฏููโุชุฑ:** k6 ุฑุง ุฑู ุณุณุชู ุฌุฏุงฺฏุงูู ุงุฌุฑุง ฺฉูุฏ
2. **ุจุฑุง ุชุณุช ูุงูุนโุชุฑ:** ุงุฒ ุชุณุชโูุง RPS-based ุงุณุชูุงุฏู ฺฉูุฏ
3. **ุจุฑุง ุชุณุช production:** ุงุฒ ูุญุท production ุง staging ุงุณุชูุงุฏู ฺฉูุฏ
4. **ุจุฑุง ููุงุณู:** ููุดู ูุดุฎุตุงุช ุณุณุชู ุฑุง ุฏุฑ ฺฏุฒุงุฑุด ุฐฺฉุฑ ฺฉูุฏ

---

## 12. ุชูุณุฑ ูุชุงุฌ ูุงูุน

**ูฺฉุชู:** ุจุฑุง ูุดุงูุฏู ูุชุงุฌ ฺฉุงูู ุฏู ุชุณุช ุงูุฌุงู ุดุฏู (300 VU ู 600 VU)ุ ุจู ุจุฎุด [10. ูุชุงุฌ - ุธุฑูุช ุญุฏุงฺฉุซุฑ ูุดุงูุฏู ุดุฏู](#10-ูุชุงุฌ---ุธุฑูุช-ุญุฏุงฺฉุซุฑ-ูุดุงูุฏู-ุดุฏู) ูุฑุงุฌุนู ฺฉูุฏ.

### ฺุฑุง Latency ุจุง ูุฌูุฏ endpoint ุณุงุฏู ุจุงูุง ุงุณุชุ

ุจุง ุงูฺฉู endpoint `/hello` ุจุณุงุฑ ุณุงุฏู ุงุณุชุ ุฏุฑ ุชุณุชโูุง ุจุง VU ุจุงูุงุ avg latency ุงูุฒุงุด ูโุงุจุฏ. ุฏูุงู ุงุญุชูุงู:

1. **CPU ุงุดุจุงุน ุดุฏู:** ููุช CPU ุจู 100% ูโุฑุณุฏุ context switching ุฒุงุฏ ูโุดูุฏ
2. **Scheduler pressure:** Go runtime scheduler ุชุญุช ูุดุงุฑ ูุฑุงุฑ ูโฺฏุฑุฏ
3. **Network stack:** ุญุช localhost ูู ุชุญุช ูุดุงุฑ ูุฑุงุฑ ูโฺฏุฑุฏ
4. **Queueing:** ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ุตู ูโูุงููุฏ ุชุง CPU ุขุฒุงุฏ ุดูุฏ

**ูฺฉุชู:** ุงู ุทุจุน ุงุณุช. ุฏุฑ ูุดุงุฑ ุจุงูุงุ latency ุงูุฒุงุด ูโุงุจุฏ ุญุช ุจุฑุง endpointโูุง ุณุงุฏู.

### ุงูฺฏู ฺฉูุงุณฺฉ ุงุดุจุงุน CPU

ุงุฒ ููุงุณู ุฏู ุชุณุช ูโุชูุงู ุงูฺฏู ฺฉูุงุณฺฉ "ุงุดุจุงุน CPU / contention" ุฑุง ูุดุงูุฏู ฺฉุฑุฏ:

1. **ุชุง ฺฉ ููุทู:** RPS ู latency ูุฑ ุฏู ุฎูุจ ูุณุชูุฏ
2. **ุจุนุฏ ุงุฒ ุขู ููุทู:** RPS ุฏฺฏุฑ ุฑุดุฏ ููโฺฉูุฏ (ุง ุฑุดุฏ ฺฉู ุฏุงุฑุฏ)
3. **ุงูุง Latency:** ุจู ุตูุฑุช ููุง ุงูุฒุงุด ูโุงุจุฏ

**ูุซุงู ุงุฒ ุชุณุชโูุง ุงูุฌุงู ุดุฏู:**
- ุชุณุช 1 (300 VU): RPS ~11.1kุ p95 = 38ms โ
- ุชุณุช 2 (600 VU): RPS ~13.1k (+18%)ุ p95 = 66ms โ

**ูุชุฌู:** ุฏู ุจุฑุงุจุฑ ฺฉุฑุฏู VU ููุท 18% RPS ุงุถุงูู ฺฉุฑุฏุ ุงูุง p95 ุฑุง 71% ุงูุฒุงุด ุฏุงุฏ.

### ูุฑุงุญู ุจุนุฏ

1. **ุชุณุช ุจุง VU ุจุดุชุฑ:** ููู ุชุณุช ุฑุง ุจุง `target: 800` ุง `target: 1000` ุงุฌุฑุง ฺฉูุฏ ุชุง ุจุจูุฏ:
   - ุขุง RPS ุจุงูุงุชุฑ ูโุฑูุฏ ุง ููุงู ุญูุงู 13k ุณูู ูโุฒูุฏุ
   - ุขุง p95/p99 ุงุฒ threshold ุฑุฏ ูโฺฉูุฏุ

2. **ุชุณุช RPS-based:** ุงุฒ `constant-arrival-rate` ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ุฏูู ูุดุฎุต ุดูุฏ:
   - "ฺู RPS ูพุงุฏุงุฑ ุฑุง ูโุชูุงู ุชุถูู ฺฉู" (ูู ููุท max burst)

3. **ุชุณุช ุฑู ูุงุดู ุฌุฏุง:** k6 ุฑุง ุฑู ูุงุดู ุฌุฏุงฺฏุงูู ุงุฌุฑุง ฺฉูุฏ ุชุง ูุญุฏูุฏุช CPU ฺฉูุงูุช ุญุฐู ุดูุฏ

---

## ุฎูุงุตู

ุงู ูุณุชูุฏ ุฑุงูููุง ฺฉุงูู ุชุณุช ุจุงุฑ ููุฒูุงู ุจุฑุง endpoint `/hello` ุงุณุช. ุจุง ุฏูุจุงู ฺฉุฑุฏู ุงู ุฑุงูููุง ูโุชูุงูุฏ:

- โ ุจุง ููุงูู ูพุงู k6 ุขุดูุง ุดูุฏ
- โ ุชุณุชโูุง ููุฏูุงุช (Smoke ู Baseline) ุฑุง ุงุฌุฑุง ฺฉูุฏ
- โ ุชุณุช ุจุงุฑ ููุฒูุงู ุฑุง ุงุฌุฑุง ู ุชุญูู ฺฉูุฏ
- โ ูุชุงุฌ ุฏู ุชุณุช ูุฎุชูู ุฑุง ููุงุณู ฺฉูุฏ
- โ ุธุฑูุช ุญุฏุงฺฉุซุฑ ุณุณุชู ุฑุง ุดูุงุณุง ฺฉูุฏ
- โ ููุทู ุดฺฉุณุช ุฑุง ูพุฏุง ฺฉูุฏ
- โ ูุชุงุฌ ุฑุง ุจู ุตูุฑุช ุญุฑููโุง ฺฏุฒุงุฑุด ุฏูุฏ
- โ ูุญุฏูุฏุชโูุง ุณุณุชู ุฑุง ุฏุฑฺฉ ฺฉูุฏ

**ูฺฉุชู ููุง:** ููุดู ูุชุงุฌ ุฑุง ุจุง ุชูุฌู ุจู ูุดุฎุตุงุช ุณุณุชู ู ูุญุท ุชุณุช ุชูุณุฑ ฺฉูุฏ. ูุชุงุฌ ุชุณุช ูุญู ููฺฉู ุงุณุช ุจุง production ูุชูุงูุช ุจุงุดุฏ.

---

## ููุงุจุน ู ูุฑุงุฌุน

- [k6 Documentation](https://k6.io/docs/)
- [k6 Thresholds](https://k6.io/docs/using-k6/thresholds/)
- [k6 Stages](https://k6.io/docs/using-k6/scenarios/stages/)
- [Load Testing Best Practices](https://k6.io/docs/test-types/)

