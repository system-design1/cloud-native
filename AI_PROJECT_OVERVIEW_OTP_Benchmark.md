# ๐ AI Project Overview -- Cloud-Native OTP Service (Benchmark-Oriented)

------------------------------------------------------------------------

## 1๏ธโฃ ูุนุฑู ูพุฑูฺู

ุงู ูพุฑูฺู ฺฉ ุณุฑูุณ **Cloud-Nativeุ Observability-First ู
Production-Aware** ุจุง Go + Gin ุงุณุช ฺฉู ุณูุงุฑู ูุงูุน ฺฉ **OTP Provider**
ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ.

ูุฏู ุงุตู ูพุฑูฺู:

-   ูพุงุฏูโุณุงุฒ ฺฉ ุณุฑูุณ REST ุงุณุชุงูุฏุงุฑุฏ ุจุง ูุนูุงุฑ Production-Ready\
-   ูพุงุฏูโุณุงุฒ ฺฉุงูู Observability (Metrics / Logs / Tracing)\
-   ุทุฑุงุญ ู ุงุฌุฑุง Benchmarkูุง ูุฑุญููโุง ุจุง k6\
-   ููุงุณู ุนูู ุธุฑูุช ุจุฎุดโูุง ูุฎุชูู ุณุณุชู\
-   ุงุณุชุฎุฑุงุฌ ฺฏุฒุงุฑุด ูุงุจู ุงุฑุงุฆู ุจุฑุง ุชู

------------------------------------------------------------------------

## 2๏ธโฃ ูุนูุงุฑ ุณุฑูุณ

### ๐น Entry Point

`cmd/server/main.go`\
ูุณุฆูู load ฺฉุฑุฏู configุ ุณุงุฎุช loggerุ tracer ู ุจุงูุง ุขูุฑุฏู HTTP server.

------------------------------------------------------------------------

### ๐น API Layer

**ูุณุฑ:** `internal/api/`

Endpointูุง ูพุงู:

-   `/hello`
-   `/delayed-hello` (ุจุฑุง ุชุณุช latency)
-   `/health`
-   `/ready`
-   `/live`
-   `/test-error`
-   `/metrics`

------------------------------------------------------------------------

### ๐น Middleware Stack

-   Prometheus Metrics
-   OpenTelemetry Tracing
-   Correlation ID
-   Structured Logging (Trace-aware)
-   Global Error Handler

ุชุฑุชุจ middlewareูุง ฺฉุงููุงู ุขฺฏุงูุงูู ุชูุธู ุดุฏู ุงุณุช.

------------------------------------------------------------------------

### ๐น Lifecycle Management

-   ูุฏุฑุช state ุณุฑูุณ (ready / live / shutdown)
-   ูพุงุฏูโุณุงุฒ Graceful Shutdown
-   ุงุชุตุงู health endpoints ุจู state ูุงูุน ุณุฑูุณ

------------------------------------------------------------------------

### ๐น Observability Stack

ุจุง docker-compose:

-   Prometheus
-   Grafana
-   Loki + Promtail
-   Tempo + Jaeger

ุชูุงู configูุง versioned ู ุฏุงุฎู ูพุฑูฺู ูุฑุงุฑ ุฏุงุฑูุฏ.

------------------------------------------------------------------------

## 3๏ธโฃ ุณูุงุฑู ุจุฒูุณ OTP

ุณุฑูุณ ููุด ฺฉ **OTP Provider** ุจุฑุง ฺูุฏ Tenant ุฑุง ุฏุงุฑุฏ.

### ุฌุฑุงู ุงุตู ุงุฑุณุงู OTP (Send Flow)

1.  ุฏุฑุงูุช ุชูุธูุงุช tenant ุงุฒ ุฏุชุงุจุณ (SELECT)
2.  ุชููุฏ OTP ุดุด ุฑูู
3.  ุฐุฎุฑู OTP ุจุง TTL (ูุซูุงู ุฏุฑ Redis)
4.  ุจุงุฒฺฏุฑุฏุงูุฏู 200 ุจู ฺฉุงุฑุจุฑ
5.  ุงุฑุณุงู async ุฏุฑุฎูุงุณุช ุจู SMS Provider ุฎุงุฑุฌ
6.  ุซุจุช ูุงฺฏ ุงุฑุณุงู OTP ุฏุฑ ุฌุฏูู ฺฏุฒุงุฑุดโฺฏุฑ (INSERT)

ูุฏู Benchmarkูุง: ุงูุฏุงุฒูโฺฏุฑ ุธุฑูุช ูุฑ ุจุฎุด ุจู ุตูุฑุช ูุณุชูู ู ุณูพุณ ููุงุณู
ุขูโูุง.

------------------------------------------------------------------------

## 4๏ธโฃ ููุณูู Benchmark

-   ูุฑ Benchmark ููุท ฺฉ ูุชุบุฑ ุงุตู ุฑุง ุชุณุช ูโฺฉูุฏ
-   ุชุณุชโูุง ุจุงุฏ reproducible ุจุงุดูุฏ
-   ุงุจุฒุงุฑ ุชุณุช ูุจุงุฏ bottleneck ุดูุฏ

### ุงุตูู k6:

-   ุงุณุชูุงุฏู ุงุฒ tag `name` ุซุงุจุช ุจุฑุง ุฌููฺฏุฑ ุงุฒ High Cardinality
-   Sample ฺฉุฑุฏู checkูุง (ูุซูุงู 1ูช)
-   ุฌุฏุง ฺฉุฑุฏู setup ู main ุจุง tag `phase`
-   ุงุนูุงู thresholds ููุท ุฑู `phase:main`

------------------------------------------------------------------------

## 5๏ธโฃ ฺฉุงุฑูุง ุงูุฌุงูโุดุฏู ุชุง ุงู ูุญุธู

### โ 5.1 Baseline -- ุชููุฏ OTP (CPU Bound)

-   ุงุณฺฉุฑูพุช: `k6/07-otp-code-capacity.js`
-   ููุท ุชููุฏ OTP ุจุฏูู DB/Redis
-   ุซุจุช ุจูุชุฑู Performance ููฺฉู ุจู ุนููุงู Baseline

------------------------------------------------------------------------

### โ 5.2 Benchmark -- Select ุงุฒ PostgreSQL

-   ุงุณฺฉุฑูพุช: `k6/09-tenant-settings-capacity.js`
-   ุชุณุช ุธุฑูุช ฺฉ SELECT ุณุงุฏู
-   ุซุจุช ูุชุงุฌ ุจุฑุง ููุงุณู ุจุง Baseline

------------------------------------------------------------------------

### โ 5.3 ุขูุงุฏูโุณุงุฒ Benchmark -- Insert ุฏุฑ PostgreSQL

-   ุงุฌุงุฏ ุฌุฏูู: `tenant_settings_for_insert_new`
-   ูุฏู: ุงูุฏุงุฒูโฺฏุฑ ุธุฑูุช INSERT ุณุงุฏู
-   ุฏุงุฏูโูุง hardcoded ุจุฑุง ฺฉุงูุด overhead

------------------------------------------------------------------------

### โ 5.4 Benchmark Redis (GET/SET) ุจุง ุจูููโุณุงุฒ ุญุฑููโุง

-   ฺฉูุชุฑู High Cardinality
-   Sample ฺฉุฑุฏู checkูุง
-   Seed ุฏุฑ setup
-   Threshold ููุท ุฑู main
-   Stageูุง ูพุงุฏุงุฑ

------------------------------------------------------------------------

## 6๏ธโฃ ูุถุนุช ูุนู ูพุฑูฺู

ูพุฑูฺู ุฏุฑ ูุงุฒ Benchmarking ูุฑุญููโุง ูุฑุงุฑ ุฏุงุฑุฏ.

Baselineูุง ูุณุชูู ุจุฑุง:

-   CPU (OTP generation)
-   DB Select
-   Redis

ุซุจุช ุดุฏูโุงูุฏ.

ุฏุฑ ุญุงู ุญุงุถุฑ ุชูุฑฺฉุฒ ุฑู:

-   Benchmark Insert
-   ุณูพุณ ุชุฑฺฉุจ ุณูุงุฑููุง
-   ุฏุฑ ููุงุช ุงุฌุฑุง Full Send Flow Benchmark
-   ุชููุฏ ฺฏุฒุงุฑุด ููุง ุจุฑุง ุชู

------------------------------------------------------------------------

## ๐ฏ ูุฏู ููุง

ุฑุณุฏู ุจู ฺฉ ฺฏุฒุงุฑุด ุฏูู ู ูุงุจู ุฏูุงุน ุดุงูู:

-   Capacity ูุฑ ูุงู ุณุณุชู
-   ููุงุณู Bottleneckูุง
-   ุชุญูู ุฑูุชุงุฑ ุณุณุชู ุชุญุช ุจุงุฑ
-   ุงุฑุงุฆู ูพุดููุงุฏูุง ูุนูุงุฑ ูุจุชู ุจุฑ ุฏุงุฏู
